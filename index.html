<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
    
    <script>
      // LOGIC: Make objects breakable and respawn
      AFRAME.registerComponent('destructible', {
        init: function () {
          this.el.addEventListener('click', () => {
            // Create "Explosion" fragments
            for (let i = 0; i < 4; i++) {
              let frag = document.createElement('a-box');
              frag.setAttribute('width', '0.3'); frag.setAttribute('height', '0.3'); frag.setAttribute('depth', '0.3');
              frag.setAttribute('color', this.el.getAttribute('color'));
              frag.setAttribute('position', this.el.getAttribute('position'));
              // Make them fly up and away
              frag.setAttribute('animation', `property: position; to: ${Math.random()*4-2} 5 ${Math.random()*-4-2}; dur: 800; easing: easeOutQuad`);
              this.el.sceneEl.appendChild(frag);
              setTimeout(() => frag.remove(), 800);
            }

            // Hide the original object
            const originalPos = this.el.getAttribute('position');
            this.el.setAttribute('visible', 'false');
            this.el.setAttribute('class', 'not-target'); // Disable shooting it while hidden

            // Respawn after 5 seconds
            setTimeout(() => {
              this.el.setAttribute('visible', 'true');
              this.el.setAttribute('class', 'interactable');
            }, 5000);
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene renderer="antialias: true" cursor="rayOrigin: mouse">
      
      <a-assets>
        <a-mixin id="building" geometry="primitive: box" material="color: #555" destructible class="interactable"></a-mixin>
      </a-assets>

      <a-entity id="rig" movement-controls="fly: false; speed: 0.2">
        <a-entity camera position="0 1.6 0" look-controls></a-entity>
        
        <a-entity laser-controls="hand: right" raycaster="objects: .interactable; far: 20">
          <a-box position="0 -0.05 -0.15" rotation="-10 0 0" width="0.05" height="0.1" depth="0.2" color="#222">
            <a-box position="0 0.07 -0.1" width="0.05" height="0.05" depth="0.3" color="#333"></a-box>
          </a-box>
        </a-entity>

        <a-entity oculus-touch-controls="hand: left"></a-entity>
      </a-entity>

      <a-sky color="#87CEEB"></a-sky>
      <a-grid width="50" height="50" color="#444"></a-grid>

      <a-entity mixin="building" position="-4 2 -8" scale="2 4 2" material="color: #778899"></a-entity>
      <a-entity mixin="building" position="4 3 -10" scale="3 6 3" material="color: #696969"></a-entity>
      <a-entity mixin="building" position="-6 1.5 -4" scale="1.5 3 1.5" material="color: #708090"></a-entity>
      <a-entity mixin="building" position="7 2 -5" scale="2 4 2" material="color: #483D8B"></a-entity>

    </a-scene>
  </body>
</html>
